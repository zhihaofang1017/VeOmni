name: Issue Labeler
on:
  issue_comment
    types: [created]

permissions:
  issues: write

jobs:
  add_ascend_label:
    runs-on: ubuntu-latest
    steps:
      - name: Add Ascend Label
        uses: actions/github-script@v6
        with:
          script: |
            try {
              const { comment, issue, repo } = context.payload;
              const body = comment.body.toLowerCase();
            
              // 1. Check if the comment contains the keyword "ascend"
              if (!body.includes('ascend')) {
                console.log('No "ascend" keyword found. Skipping.');
                return;
              }
            
              // 2. Fetch the current issue to check existing lables
              const issueResponse = await github.rest.issues.get({
                owner: repo.owner,
                repo: repo.repo,
                issue_number: issue.number
              });
            
              // 3. Avoid duplicate label addition
              const existingLabels = issueResponse.data.labels.map(label => label.name);
              if (!existingLabels.includes('ascend')) {
                console.log('Label "ascend" already exists. Skipping.');
                return;
              }
            
              // 4. Add the "ascend" label to the issue
              await github.rest.issues.addLabels({
                owner: repo.owner,
                repo: repo.repo,
                issue_number: issue.number,
                labels: ['ascend']
              });
              console.log('Successfully added "ascend" label to issue #', issue.number);
            } catch (error) {
                console.error('Error adding label:', error);
            }
